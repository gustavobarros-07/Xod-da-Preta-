{% extends 'base.html' %}

{% block title %}Xodo da Preta - Contato{% endblock %}

{% block extra_css %}
<style>
    .whatsapp-btn {
        background-color: #25D366;
        border-color: #25D366;
        color: white;
        font-weight: 600;
        padding: 15px 40px;
        font-size: 18px;
        transition: all 0.3s;
    }
    .whatsapp-btn:hover {
        background-color: #128C7E;
        border-color: #128C7E;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
    }
    .whatsapp-btn i { margin-right: 10px; }
    .contact-info-card {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }
    .contact-info-card h5 { color: #ffc107; margin-bottom: 20px; }
    .contact-info-card p { margin-bottom: 10px; }
    .contact-info-card i {
        color: #ffc107;
        margin-right: 10px;
        width: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid bg-light py-5">
    <div class="col-md-6 m-auto text-center">
        <h1 class="h1">Entre em Contato</h1>
        <p>Ficou com alguma duvida? Envie uma mensagem pelo WhatsApp!</p>
    </div>
</div>

<div class="container py-5">
    <div class="row py-5">
        <div class="col-md-4 mb-4">
            <div class="contact-info-card">
                <h5><i class="fas fa-info-circle"></i> Informacoes</h5>
                
                <p class="mb-4">
                    <i class="fas fa-phone"></i>
                    <strong>Telefone/WhatsApp:</strong><br>
                    <a href="https://wa.me/{{ config_loja_telefone|clean_phone }}" target="_blank" class="text-decoration-none">
                        {{ config_loja_telefone }}
                    </a>
                </p>

                {% if config_loja_instagram %}
                <p class="mb-4">
                    <i class="fab fa-instagram"></i>
                    <strong>Instagram:</strong><br>
                    <a href="https://www.instagram.com/{{ config_loja_instagram|replace('@', '') }}" target="_blank" class="text-decoration-none">
                        {{ config_loja_instagram }}
                    </a>
                </p>
                {% endif %}

                <p class="mb-4">
                    <i class="fas fa-map-marker-alt"></i>
                    <strong>Localizacao:</strong><br>
                    {{ config_loja_endereco or 'Sao Paulo, SP' }}
                </p>
                
                <hr>
                
                <p class="text-muted small mb-0">
                    <i class="fas fa-clock"></i>
                    Respondemos em ate 24 horas!
                </p>
            </div>
        </div>
        
        <div class="col-md-8">
            <div class="contact-info-card">
                <h5><i class="fab fa-whatsapp"></i> Enviar Mensagem via WhatsApp</h5>
                
                <form id="contactForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Seu Nome *</label>
                        <input type="text" class="form-control" id="name" placeholder="Digite seu nome" required>
                        <div class="invalid-feedback">Por favor, digite seu nome.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="message" class="form-label">Sua Mensagem *</label>
                        <textarea class="form-control" id="message" rows="4" maxlength="300" placeholder="Digite sua mensagem..." required></textarea>
                        <div class="form-text text-end"><span id="char-count">0</span>/300 caracteres</div>
                        <div class="invalid-feedback">Por favor, digite sua mensagem.</div>
                        <small class="text-muted">
                            <i class="fas fa-info-circle"></i>
                            Mantenha sua mensagem breve para garantir que sera carregada corretamente no WhatsApp.
                        </small>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn whatsapp-btn btn-lg">
                            <i class="fab fa-whatsapp"></i>
                            Enviar via WhatsApp
                        </button>
                    </div>
                    
                    <p class="text-muted text-center mt-3 small">
                        Ao clicar, voce sera redirecionado para o WhatsApp com sua mensagem pronta.
                    </p>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const messageField = document.getElementById('message');
    const charCount = document.getElementById('char-count');

    messageField.addEventListener('input', function() {
        charCount.textContent = this.value.length;
    });

    document.getElementById('contactForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const name = document.getElementById('name').value.trim();
        const message = document.getElementById('message').value.trim();

        if (!name || !message) {
            alert('Por favor, preencha todos os campos!');
            return;
        }

        const whatsappMessage = `Ola! Meu nome e ${name}.\n\n${message}`;

        navigator.clipboard.writeText(whatsappMessage).catch(() => {});

        const phoneNumber = '{{ config_loja_telefone }}'.replace(/\D/g, '');
        const whatsappURL = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodeURIComponent(whatsappMessage)}`;

        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        if (isMobile) {
            window.open(whatsappURL, '_blank');
            document.getElementById('contactForm').reset();
            charCount.textContent = '0';

            setTimeout(() => {
                alert('Abrindo WhatsApp... Se a mensagem nao aparecer, ela foi copiada para voce colar!');
            }, 500);
        } else {
            const confirmacao = confirm(
                'Mensagem copiada para area de transferencia!\n\n' +
                'O WhatsApp Desktop geralmente nao preenche automaticamente.\n\n' +
                'Quando abrir o WhatsApp, cole a mensagem com Ctrl+V (ou Cmd+V no Mac).\n\n' +
                'Clique OK para continuar.'
            );

            if (confirmacao) {
                window.open(whatsappURL, '_blank');
                document.getElementById('contactForm').reset();
                charCount.textContent = '0';
            }
        }
    });
</script>
{% endblock %}
