{% extends 'base.html' %}

{% block title %}Xod√≥ da Preta - Contato{% endblock %}

{% block extra_css %}
<style>
    .whatsapp-btn {
        background-color: #25D366;
        border-color: #25D366;
        color: white;
        font-weight: 600;
        padding: 15px 40px;
        font-size: 18px;
        transition: all 0.3s;
    }
    
    .whatsapp-btn:hover {
        background-color: #128C7E;
        border-color: #128C7E;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
    }
    
    .whatsapp-btn i {
        margin-right: 10px;
    }
    
    .contact-info-card {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }
    
    .contact-info-card h5 {
        color: #ffc107;
        margin-bottom: 20px;
    }
    
    .contact-info-card p {
        margin-bottom: 10px;
    }
    
    .contact-info-card i {
        color: #ffc107;
        margin-right: 10px;
        width: 20px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Start Content Page -->
<div class="container-fluid bg-light py-5">
    <div class="col-md-6 m-auto text-center">
        <h1 class="h1">Entre em Contato</h1>
        <p>Ficou com alguma d√∫vida? Envie uma mensagem pelo WhatsApp!</p>
    </div>
</div>

<!-- Start Contact -->
<div class="container py-5">
    <div class="row py-5">
        <!-- Informa√ß√µes de Contato -->
        <div class="col-md-4 mb-4">
            <div class="contact-info-card">
                <h5><i class="fas fa-info-circle"></i> Informa√ß√µes</h5>
                
                <p class="mb-4">
                    <i class="fas fa-phone"></i>
                    <strong>Telefone/WhatsApp:</strong><br>
                    <a href="https://wa.me/{{ config_loja_telefone|clean_phone }}" target="_blank" class="text-decoration-none">
                        {{ config_loja_telefone }}
                    </a>
                </p>

                <p class="mb-4">
                    <i class="fab fa-instagram"></i>
                    <strong>Instagram:</strong><br>
                    <a href="https://www.instagram.com/xododapreta" target="_blank" class="text-decoration-none">
                        @xododapreta
                    </a>
                </p>

                <p class="mb-4">
                    <i class="fas fa-map-marker-alt"></i>
                    <strong>Localiza√ß√£o:</strong><br>
                    S√£o Paulo, SP
                </p>
                
                <hr>
                
                <p class="text-muted small mb-0">
                    <i class="fas fa-clock"></i>
                    Respondemos em at√© 24 horas!
                </p>
            </div>
        </div>
        
        <!-- Formul√°rio -->
        <div class="col-md-8">
            <div class="contact-info-card">
                <h5><i class="fab fa-whatsapp"></i> Enviar Mensagem via WhatsApp</h5>
                
                <form id="contactForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Seu Nome *</label>
                        <input type="text" 
                               class="form-control" 
                               id="name" 
                               placeholder="Digite seu nome"
                               required>
                        <div class="invalid-feedback">
                            Por favor, digite seu nome.
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="message" class="form-label">Sua Mensagem *</label>
                        <textarea class="form-control"
                                  id="message"
                                  rows="4"
                                  maxlength="300"
                                  placeholder="Digite sua mensagem..."
                                  required></textarea>
                        <div class="form-text text-end">
                            <span id="char-count">0</span>/300 caracteres
                        </div>
                        <div class="invalid-feedback">
                            Por favor, digite sua mensagem.
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-info-circle"></i>
                            Mantenha sua mensagem breve para garantir que ser√° carregada corretamente no WhatsApp.
                        </small>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn whatsapp-btn btn-lg">
                            <i class="fab fa-whatsapp"></i>
                            Enviar via WhatsApp
                        </button>
                    </div>
                    
                    <p class="text-muted text-center mt-3 small">
                        Ao clicar, voc√™ ser√° redirecionado para o WhatsApp com sua mensagem pronta.
                    </p>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- End Contact -->
{% endblock %}

{% block extra_js %}
<!-- WhatsApp Integration Script -->
<script>
    // Contador de caracteres
    const messageField = document.getElementById('message');
    const charCount = document.getElementById('char-count');

    messageField.addEventListener('input', function() {
        charCount.textContent = this.value.length;
    });

    // Envio do formul√°rio
    document.getElementById('contactForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const name = document.getElementById('name').value.trim();
        const message = document.getElementById('message').value.trim();

        if (!name || !message) {
            alert('Por favor, preencha todos os campos!');
            return;
        }

        // Mensagem compacta
        const whatsappMessage = `Ol√°! Meu nome √© ${name}.\n\n${message}`;

        // Copiar para √°rea de transfer√™ncia como fallback
        navigator.clipboard.writeText(whatsappMessage).catch(err => {
            console.warn('N√£o foi poss√≠vel copiar automaticamente');
        });

        // Limpar n√∫mero de telefone removendo todos os caracteres n√£o-num√©ricos
        const phoneNumber = '{{ config_loja_telefone }}'.replace(/\D/g, '');
        console.log('N√∫mero WhatsApp (Contact):', phoneNumber); // Debug
        const whatsappURL = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodeURIComponent(whatsappMessage)}`;

        // Detectar se √© mobile ou desktop
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        if (isMobile) {
            // Mobile: Abrir direto (mensagem geralmente preenche automaticamente)
            window.open(whatsappURL, '_blank');
            document.getElementById('contactForm').reset();
            charCount.textContent = '0';

            // Feedback sutil
            setTimeout(() => {
                alert('üí¨ Abrindo WhatsApp...\n\nSe a mensagem n√£o aparecer, ela foi copiada para voc√™ colar!');
            }, 500);
        } else {
            // Desktop: Avisar sobre a c√≥pia
            const confirmacao = confirm(
                'üìã Mensagem copiada para √°rea de transfer√™ncia!\n\n' +
                'O WhatsApp Desktop geralmente n√£o preenche automaticamente.\n\n' +
                'Quando abrir o WhatsApp, cole a mensagem com Ctrl+V (ou Cmd+V no Mac).\n\n' +
                'Clique OK para continuar.'
            );

            if (confirmacao) {
                window.open(whatsappURL, '_blank');
                document.getElementById('contactForm').reset();
                charCount.textContent = '0';
            }
        }
    });
</script>
{% endblock %}